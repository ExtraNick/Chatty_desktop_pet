[gd_scene load_steps=11 format=3 uid="uid://c0ci8rnlg2lwe"]

[ext_resource type="Texture2D" uid="uid://bx0fsn3w6t35a" path="res://demonite_idle1.png" id="1_x3e4l"]
[ext_resource type="Texture2D" uid="uid://lkowl4pkn0b1" path="res://demonite_float_correct.png" id="2_40ims"]
[ext_resource type="Texture2D" uid="uid://cw04ljy6ye5mj" path="res://demonite_idle3.png" id="2_tj1yi"]
[ext_resource type="Texture2D" uid="uid://cu6nb18u857r5" path="res://demonite_idle2.png" id="3_63mtt"]
[ext_resource type="Texture2D" uid="uid://d1bbwhcspj627" path="res://demonite_moving_right1.png" id="4_f1ch0"]
[ext_resource type="Texture2D" uid="uid://bjdfmky03voyc" path="res://demonite_moving_right2.png" id="5_y5b51"]
[ext_resource type="Texture2D" uid="uid://df2g6eyrrn4i4" path="res://heart_heart.png" id="7_ucvvb"]

[sub_resource type="GDScript" id="GDScript_prqq1"]
resource_name = "player.gd"
script/source = "extends Area2D

@export var speed = 1 # How fast the player will move (pixels/sec).
@export var player_size: Vector2i = Vector2i(48	, 48)
@onready var _MainWindow: Window = get_window()
@onready var animation_selector = 0
var start_playable_area = DisplayServer.screen_get_position() #First pixel at the top left
var last_position = _MainWindow
var screen_size # Size of the game window
var sticked_side = false
var sticked_top  = false
var sticked_bottom = false
# Called when the node enters the scene tree for the first time.
var maximum_window_size = DisplayServer.screen_get_size() #Last pixel at the bottom right
var true_position #mainly for debugging then later on for mouse position
var total_maximum_window_size #also mainly for debugging
var decide_stick #pet decides if he wants to stick or not
var swap_cooldown = false #Sets a cooldown for sticking to screen sides horizontall
var swap_direction_cooldown = true #Incase the pet tries to walk towards the limit closest to the side it swapped on
var far_x_limit 
var close_x_limit
var close_y_limit
var far_y_limit
var starting_y_position
var pet_play_area_y
var pet_play_area_x
var sprite_position_x = 24
var sprite_position_y = 48 
var falling_sprite_position_y = 24
var dragging = false
var snapshot: Vector2  #used for snapshotting character y position when dragged
var falling = false
var draggable = false
var discover_if_taskbar = 0
var falling_gravity = 0.89
var x_speed_array = []
var y_speed_array = []
var flinging = false
var flinging_velocity_x = 0
var flinging_velocity_y = 0
var dragged_long = false
var heart_visible = false
var heart_rotate = false
@onready var falling_velocity: Vector2
func _ready():
	#screen_size = get_viewport_rect().size
	get_tree().get_root().set_transparent_background(true)
	$Window/Sprite2D.modulate.a8 = 100
	$Timer4.start()
	total_maximum_window_size = start_playable_area + maximum_window_size #The sum of starting pixel and ending pixel
	
	#far_x_limit = total_maximum_window_size - (Vector2i(player_size)/5)  - ((Vector2i(player_size)+Vector2i(player_size)/1))
	far_x_limit = total_maximum_window_size - player_size
	close_x_limit = (DisplayServer.screen_get_position())
	
	close_y_limit = start_playable_area #just for easier naming
	far_y_limit = Vector2(maximum_window_size.x, close_y_limit.y)
	
	pet_play_area_y = total_maximum_window_size.y -  get_taskbar_height()
	discover_if_taskbar = pet_play_area_y + sprite_position_y - 7
	pet_play_area_x = total_maximum_window_size.x /2
	_MainWindow.position.y = pet_play_area_y
	_MainWindow.position.x = pet_play_area_x
	sticked_bottom = true
# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	#_MainWindow.set_canvas_cull_mask_bit(1, false)
	set_passthrough(position)
	var velocity = Vector2.ZERO # The player's movement vector.
	if animation_selector == 0 and sticked_side == false and falling == false:
		$AnimatedSprite2D.animation = \"idle\"
	if animation_selector == 2 and sticked_side == false and sticked_top == false:
		velocity.x += 1
	if animation_selector == 1 and sticked_side == false and sticked_top == false:
		velocity.x -= 1
	if Input.is_action_pressed(\"move_right\"):
		velocity.x += 1
	if Input.is_action_pressed(\"move_left\"):
		velocity.x -= 1
	if Input.is_action_pressed(\"move_down\"):
		velocity.y += 1
	if Input.is_action_pressed(\"move_up\"):
		velocity.y -= 1

#Controls the bottom left and right corner swapping
	if (_MainWindow.position.x == far_x_limit.x or _MainWindow.position.x == close_x_limit.x) and _MainWindow.position.y != 0 and sticked_side == false and swap_cooldown == false and sticked_top == false:
		$Timer2.start()
		swap_cooldown = true
		decide_stick = floor(randf_range(0,2))
		print(\"Decided:\")
		print(decide_stick)
		if decide_stick == 0:
			sticked_side = false #decide against swapping sides
			print(\"no swapping aaaaaaaaab\")
			if _MainWindow.position.x == close_x_limit.x and sticked_side == false and dragging == false and falling == false:
				animation_selector = 2
			if _MainWindow.position.x == far_x_limit.x and sticked_side == false and dragging == false and falling == false:
				animation_selector = 1
		if decide_stick == 1:
			sticked_side = true
			sticked_bottom = false
			dragging = false
			print(\"swapping to y axis abcde\")
			animation_selector = 0
			velocity.x = 0
			velocity.y -= 1
			sprite_position_y = 48
			if _MainWindow.position.x == close_x_limit.x:
				$AnimatedSprite2D.rotation_degrees = 90
				$Window/Sprite2D.rotation = $AnimatedSprite2D.rotation
			elif _MainWindow.position.x == far_x_limit.x:
				$AnimatedSprite2D.rotation_degrees = -90
				$Window/Sprite2D.rotation = $AnimatedSprite2D.rotation
				$AnimatedSprite2D.flip_h = true
# this controls side swapping to bottom
	if (_MainWindow.position.y == pet_play_area_y) and sticked_side == true and swap_cooldown == false:
		$Timer2.start()
		swap_cooldown = true
		decide_stick = floor(randf_range(0,2))
		print(\"Decided:\")
		print(decide_stick)
		if decide_stick == 0:
			sticked_side = true #decide against swapping sides
			print(\"no swapping  bbbbb\")
			if _MainWindow.position.y == pet_play_area_y:
					animation_selector = 2
		if decide_stick == 1:
			sticked_side = false
			sticked_bottom = true
			sticked_top = false
			dragging = false
			print(\"swapping to x axis\")
			velocity.y = 0
			velocity.x -= 1
			sprite_position_y = 48
			if _MainWindow.position.x == close_x_limit.x:
				$AnimatedSprite2D.rotation_degrees = 0
				$Window/Sprite2D.rotation = $AnimatedSprite2D.rotation
			elif _MainWindow.position.x == far_x_limit.x:
				$AnimatedSprite2D.rotation_degrees = 0
				$Window/Sprite2D.rotation = $AnimatedSprite2D.rotation
				$AnimatedSprite2D.flip_h = true
				
	#This starts direction for corners
			#This is for right side corner, ontop of the taskbar
	if _MainWindow.position.x == far_x_limit.x and sticked_side == true and _MainWindow.position.y > pet_play_area_y and (_MainWindow.position.y != close_y_limit.y) and animation_selector == 1 and swap_direction_cooldown == true:
		animation_selector = 2
		$Timer3.start()
		swap_direction_cooldown = false
			#This is for left side corner, ontop of taskbar
	if _MainWindow.position.x == close_x_limit.x and sticked_side == true and _MainWindow.position.y > pet_play_area_y and (_MainWindow.position.y != close_y_limit.y) and animation_selector == 1 and swap_direction_cooldown == true:
		animation_selector = 2
		$Timer3.start()
		swap_direction_cooldown = false
			#This is for bottom corner, where the side starts
	if _MainWindow.position.x == close_x_limit.x and sticked_side == false and animation_selector == 1 and swap_direction_cooldown == true:
		animation_selector = 2
		$Timer3.start()
		swap_direction_cooldown = false
			#This is for far corner, where the side starts
	if _MainWindow.position.x == far_x_limit.x and sticked_side == false and animation_selector == 2 and swap_direction_cooldown == true:
		animation_selector = 1
		$Timer3.start()
		swap_direction_cooldown = false
	if (_MainWindow.position.y <= close_y_limit.y or _MainWindow.position.y <= far_y_limit.y) and (_MainWindow.position.x == close_x_limit.x or _MainWindow.position.x == far_x_limit.x) and sticked_side == true and sticked_top == false and swap_direction_cooldown == true:
		animation_selector = 1
		$Timer3.start()
		swap_direction_cooldown = false
	#if _MainWindow.position.y == far_y_limit.y and sticked_side == true and sticked_top == false and swap_direction_cooldown == true:
		#animation_selector = 1
		#print(\"The thing you are testing is happening\")
	
#something is off with right side -> top corner swapping
		
#if (_MainWindow.position == close_x_limit) and _MainWindow.position.y == close_y_limit.y and sticked_side == true and swap_cooldown == false:		
#This controls the Top left corner swapping
#	if (_MainWindow.position.x == far_x_limit.x or _MainWindow.position.x == close_x_limit.x) and _MainWindow.position.y == 0 and sticked_side == true and swap_cooldown == false and sticked_top == false:
	if  _MainWindow.position.y == 0  and swap_cooldown == false and sticked_top == false:
		$Timer2.start()
		swap_cooldown = true
		decide_stick = floor(randf_range(0,2))
		print(\"Decided:\")
		print(decide_stick)
		if decide_stick == 0 and flinging == false:
			sticked_side = true #decide against swapping sides
			print(\"no swapping cccc\")
			if _MainWindow.position.y == start_playable_area.y:
					animation_selector = 1
		if decide_stick == 1:
			sticked_side = false
			sticked_top = true
			sticked_bottom = false
			dragging = false
			print(\"swapping to x axis\")
			animation_selector = 0
			velocity.y = 0
			velocity.x -= 1
			sprite_position_y = 24
			if _MainWindow.position.y == close_y_limit.y:
				$AnimatedSprite2D.rotation_degrees = 180
				$Window/Sprite2D.rotation = $AnimatedSprite2D.rotation
			elif _MainWindow.position.y == far_y_limit.y:
				$AnimatedSprite2D.rotation_degrees = -180
				$Window/Sprite2D.rotation = $AnimatedSprite2D.rotation
				$AnimatedSprite2D.flip_h = false
				
#This controls the Top right corner swapping
	#if (_MainWindow.position.x == far_x_limit.x) and _MainWindow.position.y == far_y_limit.y and (sticked_side == true) and swap_cooldown == false:
		#$Timer2.start()
		#swap_cooldown = true
		#decide_stick = floor(randf_range(0,2))
		#print(\"Decided:\")
		#print(decide_stick)
		#if decide_stick == 0:
			#sticked_side = true #decide against swapping sides
			#print(\"no swapping dddddd\")
			#if _MainWindow.position.y == pet_play_area_y:
					#animation_selector = 1
		#if decide_stick == 1:
			#sticked_side = false
			#sticked_top = true
			#print(\"swapping to x axis DA\")
			#velocity.y = 0
			#velocity.x += 1
			#sprite_position_y = 24 #its either this one or the top
			#if _MainWindow.position.x == close_x_limit.x and close_y_limit.x:
				#$AnimatedSprite2D.rotation_degrees = 180
			#elif _MainWindow.position.x == far_x_limit.x and far_y_limit.x:
				#$AnimatedSprite2D.rotation_degrees = -180
				#$AnimatedSprite2D.flip_h = false

#Controls swapping top_right from top to side
	if (_MainWindow.position.x == far_x_limit.x or _MainWindow.position.x == close_x_limit.x) and _MainWindow.position.y == far_y_limit.y and sticked_side == false and swap_cooldown == false:
		$Timer2.start()
		swap_cooldown = true
		decide_stick = floor(randf_range(0,2))
		print(\"Decided:\")
		print(decide_stick)
		if decide_stick == 0:
			sticked_side = false #decide against swapping sides
			print(\"no swapping aa\")
			if _MainWindow.position.y == far_y_limit.y and sticked_top == true:
					animation_selector = 2
		if decide_stick == 1:
			sticked_side = true
			sticked_top = false
			dragging = false
			print(\"swapping to y axis a\")
			animation_selector = 0
			velocity.y = 1
			velocity.x = 0
			sprite_position_y = 48
			if _MainWindow.position.x == close_x_limit.x:
				$AnimatedSprite2D.rotation_degrees = 90
				$Window/Sprite2D.rotation = $AnimatedSprite2D.rotation
			elif _MainWindow.position.x == far_x_limit.x:
				$AnimatedSprite2D.rotation_degrees = -90
				$Window/Sprite2D.rotation = $AnimatedSprite2D.rotation
				$AnimatedSprite2D.flip_h = false
	#if falling == false and dragging == false:				
	if animation_selector == 2 and sticked_side == true and sticked_top == false:
		velocity.y -= 1
	if animation_selector == 1 and sticked_side == true and sticked_top == false:
		velocity.y += 1
	if animation_selector == 2 and sticked_top == true and sticked_side == false:
		velocity.x += 1 
	if animation_selector == 1 and sticked_top == true and sticked_side == false:
		velocity.x -= 1
	if animation_selector == 2 and sticked_side == false and sticked_top == false:
		velocity.x += 1
	
		
	if velocity.length() > 0:
		velocity = velocity.normalized() * speed
		$AnimatedSprite2D.play()
	true_position = _MainWindow.position - DisplayServer.screen_get_position()
	if heart_visible == true:
		$Window/Sprite2D.modulate.a8 = $Window/Sprite2D.modulate.a8 + 5
		#heart while on bottom
		if $Window/Sprite2D.rotation_degrees == 10:
			heart_rotate = true
		if $Window/Sprite2D.rotation_degrees == -10:
			heart_rotate = false
		if $Window/Sprite2D.rotation_degrees <= 10 and heart_rotate == false:
			$Window/Sprite2D.rotation_degrees = $Window/Sprite2D.rotation_degrees + 1
		if $Window/Sprite2D.rotation_degrees >= -10 and heart_rotate == true:
			$Window/Sprite2D.rotation_degrees = $Window/Sprite2D.rotation_degrees - 1
			
		#heart while on left side
		if $Window/Sprite2D.rotation_degrees == 100 and sticked_side == true:
			heart_rotate = true
		if $Window/Sprite2D.rotation_degrees <= 80 and $Window/Sprite2D.rotation_degrees > 0 and sticked_side == true and heart_rotate == true:
			heart_rotate = false
		if $Window/Sprite2D.rotation_degrees <= 100 and heart_rotate == false:
			$Window/Sprite2D.rotation_degrees = $Window/Sprite2D.rotation_degrees + 1
		if $Window/Sprite2D.rotation_degrees >= 80 and heart_rotate == true:
			$Window/Sprite2D.rotation_degrees = $Window/Sprite2D.rotation_degrees - 1	
			
		#heart while on right side
		if $Window/Sprite2D.rotation_degrees >= -80 and $Window/Sprite2D.rotation_degrees < 0 and sticked_side == true:
			heart_rotate = true
		if $Window/Sprite2D.rotation_degrees == -100:
			heart_rotate = false
		if $Window/Sprite2D.rotation_degrees < -80 and heart_rotate == false:
			$Window/Sprite2D.rotation_degrees = $Window/Sprite2D.rotation_degrees + 1
		if $Window/Sprite2D.rotation_degrees > -100 and heart_rotate == true:
			$Window/Sprite2D.rotation_degrees = $Window/Sprite2D.rotation_degrees - 1
		
		#heart while on top
		if $Window/Sprite2D.rotation_degrees == 190:
			heart_rotate = true
		if $Window/Sprite2D.rotation_degrees == 170:
			heart_rotate = false
		if $Window/Sprite2D.rotation_degrees <= 190 and heart_rotate == false and sticked_top == true:
			$Window/Sprite2D.rotation_degrees = $Window/Sprite2D.rotation_degrees + 1
		if $Window/Sprite2D.rotation_degrees >= 170 and heart_rotate == true and sticked_top == true:
			$Window/Sprite2D.rotation_degrees = $Window/Sprite2D.rotation_degrees - 1
	if heart_visible == false:
		$Window/Sprite2D.rotation_degrees = $AnimatedSprite2D.rotation_degrees
	if Input.is_action_just_pressed(\"right_click\") and dragging == false and flinging == false and falling == false and heart_visible == false:
		$Window.show()
		$Timer6.start()
		heart_visible = true
		animation_selector = 0
		
	if Input.is_action_just_pressed(\"click\") and draggable == true:
		print(\"test\")
		dragging = true
		flinging = false
		$Timer5.start()
		clear_state()
	if Input.is_action_pressed(\"click\") and draggable == true and dragging == true and flinging == false:
		append_array_x(_MainWindow.position.x)
		append_array_y(_MainWindow.position.y)
		clear_state()
		flinging = false
		_MainWindow.position = Vector2(true_position) + get_global_mouse_position()-Vector2(28,18) + Vector2(start_playable_area)
		
	if Input.is_action_just_released(\"click\") and draggable == true and dragging == true:
		sprite_position_y = 48
		dragging = false
		flinging = false
		falling_velocity.y = velocity.y
		#$AnimatedSprite2D.animation = \"falling\"
		$AnimatedSprite2D.rotation = 0
		animation_selector = 0
		if (calculate_x_acceleration() != 0 or calculate_y_acceleration() != 0) and (x_speed_array.size() == 10 or y_speed_array.size() == 10) and flinging == false and dragged_long == true:
			dragged_long = false
			if calculate_x_acceleration() != 0:
				flinging_velocity_x = calculate_x_acceleration()
			if calculate_y_acceleration() != 0:
				flinging_velocity_y = calculate_y_acceleration() 
			flinging = true
	if sticked_side == false:
		if sticked_top == false:
			if sticked_bottom == false:
				falling = true
		else: 
			falling = false
	else:
		falling = false
	if flinging == true:
		x_speed_array.clear()
		y_speed_array.clear()
		if flinging_velocity_x > 0:	
			flinging_velocity_x = floor(calculate_x_velocity())
			velocity.x = flinging_velocity_x
			if flinging_velocity_x/2  < falling_velocity.y/2:
				flinging_velocity_x = 0 		
		if flinging_velocity_x < 0:
			flinging_velocity_x = round(calculate_x_velocity())
			velocity.x = flinging_velocity_x
			if flinging_velocity_x/2  > -8/2:
				flinging_velocity_x = 0
		if flinging_velocity_y > 0:
			falling_velocity.y = round(calculate_y_velocity())
			flinging_velocity_y = flinging_velocity_y - falling_velocity.y
			velocity.y = floor(flinging_velocity_y)
			if flinging_velocity_y < falling_velocity.y:
				flinging_velocity_y = 0
		if flinging_velocity_y < 0:
			falling_velocity.y = round(calculate_y_velocity() * 0.85)
			flinging_velocity_y = flinging_velocity_y + falling_velocity.y
			velocity.y = floor(flinging_velocity_y)
			if flinging_velocity_y > -falling_velocity.y:
				flinging_velocity_y = 0
	
	if (sticked_top == true or sticked_bottom == true or sticked_side == true) and flinging == true:
		flinging = false
		flinging_velocity_x = 0
		velocity.x = 0
		flinging_velocity_y = 0
		velocity.y = 0
	if flinging_velocity_x == 0 and flinging_velocity_y == 0 and flinging == true:
		flinging = false
		flinging_velocity_x = 0
		velocity.x = 0
		flinging_velocity_y = 0
		velocity.y = 0
		falling = true
	if falling == true and dragging == false and flinging == false:
		#var temporary_velocity = velocity.y + 1
		falling_velocity.y = (falling_velocity.y * falling_gravity) + (1 *falling_gravity)	#velocity.x = 0
		#falling_velocity.y = (3 * _MainWindow.position.y)/pet_play_area_y*pet_play_area_y
		velocity.y = round(falling_velocity.y)
		
		sprite_position_y = 24
		if discover_if_taskbar > pet_play_area_y:
			if _MainWindow.position.y == pet_play_area_y and falling == true:
				falling = false
				sticked_bottom = true
				$AnimatedSprite2D.rotation =0
				velocity.y = 0
				sprite_position_y = 48-7
				position.y = sprite_position_y
			elif _MainWindow.position.y == discover_if_taskbar and falling == true: 
				falling = false
				sticked_bottom = true
				velocity.y = 0
				$AnimatedSprite2D.rotation = 0
				sprite_position_y = 48
	position += velocity * delta	
	#print(position)
	#position = position.clamp(Vector2(player_size/2), Vector2(Vector2(_MainWindow.position) - Vector2(_MainWindow.min_size)))
	#position = position.clamp(_MainWindow.position, Vector2(_MainWindow.position) - Vector2(_MainWindow.min_size/3)) 
	position = position.clamp(Vector2(sprite_position_x,24), Vector2(sprite_position_x, sprite_position_y))
	last_position = _MainWindow.position
	_MainWindow.position = last_position + Vector2i((velocity*speed)*1.)
	_MainWindow.position = _MainWindow.position.clamp(close_x_limit , far_x_limit)
	if heart_visible == false:
		$Window.position = _MainWindow.position
	if discover_if_taskbar > pet_play_area_y:
		if _MainWindow.position.y > pet_play_area_y:
			_MainWindow.position.y = pet_play_area_y
	elif _MainWindow.position.y == discover_if_taskbar: 
		if _MainWindow.positiong.y > discover_if_taskbar:
			_MainWindow.position.y = discover_if_taskbar 
			clear_state()
	if velocity.x != 0 and sticked_top == false:
		$AnimatedSprite2D.animation = \"walk\"
		$AnimatedSprite2D.flip_v = false
		$AnimatedSprite2D.flip_h = velocity.x < 0
	if velocity.x != 0 and sticked_top == true:
		$AnimatedSprite2D.animation = \"walk\"
		$AnimatedSprite2D.flip_v = false
		$AnimatedSprite2D.flip_h = velocity.x > 0
	if velocity.y != 0 and falling == false:
		$AnimatedSprite2D.animation = \"walk\"
		$AnimatedSprite2D.flip_h = velocity.y > 0
		$AnimatedSprite2D.flip_h = velocity.y < 0
	if _MainWindow.position.x == far_x_limit.x and velocity.y !=0:
		$AnimatedSprite2D.animation = \"walk\"
		$AnimatedSprite2D.flip_h = velocity.y < 0
		$AnimatedSprite2D.flip_h = velocity.y > 0
	if velocity.x == 0 and velocity.y == 0 and falling == false:
		$AnimatedSprite2D.animation = \"idle\"
	if velocity.y > 0  and falling == true and dragging == false:
		$AnimatedSprite2D.animation = \"falling\"
	if dragging == true:
		$AnimatedSprite2D.animation = \"fall\"
	if heart_visible == true:
		$AnimatedSprite2D.animation = \"falling\"
		
		
	#if _MainWindow.position.x ==  1366 and sticked_side == true and swap_cooldown:
	#elif velocity.y != 0 and velocity.y < 0:
	#	$AnimatedSprite2D.animation = \"up\"
#	elif velocity.y != 0 and velocity.y > 0:
#		$AnimatedSprite2D.animation = \"fall\"
	#print(true_position)
	#print(_MainWindow.position)
	#print(position)
	#print(_MainWindow.position / Vector2i(position))
	#print(pet_play_area_y)
	#print(pet_play_area_y)
	#print(player_size.y/3)
	#print(total_maximum_window_size)
	#print(DisplayServer.screen_get_usable_rect())
	#print(DisplayServer.screen_get_size())
	#print(DisplayServer.screen_get_position())
	#print(far_y_limit)
	#print(close_x_limit)
	#print(Vector2(player_size/2))
	#print(Vector2(player_size * 4))
	#print(Vector2(Vector2(_MainWindow.position) - Vector2(player_size * 4)))
	#print(velocity.y)
	#print(animation_selector)
	#print(flinging_velocity_x)
	#print(flinging_velocity_y)
	#print(\"sticked_botom\",sticked_bottom)
	#print(\"sticked top:\",sticked_top)
	#print(\"sticked side:\",sticked_side)
	#print(\"falling:\",falling)
	#print(\"dragging:\",dragging)
func _on_timer_timeout() -> void:
	if falling == false and dragging == false and heart_visible == false:
		animation_selector = floor(randf_range(0,3))
		print(animation_selector)
func get_taskbar_height(): #from https://www.reddit.com/r/godot/comments/s5rjsv/is_there_a_way_to_get_taskbar_height_on_windows/
	return (total_maximum_window_size.y - DisplayServer.screen_get_usable_rect().size.y - DisplayServer.screen_get_position().y) + player_size.y/1 + player_size.y/3
func _on_timer_2_timeout() -> void:
	swap_cooldown = false
	pass # Replace with function body.

func _on_timer_3_timeout() -> void:
	swap_direction_cooldown = true
	pass # Replace with function body.
func set_passthrough(sprite: Vector2):
	#var texture_center: Vector2 = sprite.texture.get_size() / 2 # Center
	var texture_corners: PackedVector2Array = [
		position - Vector2(29,24), # Top left corner
		position + Vector2(24, 0) - Vector2(0, 24), # Top right corner
		position + Vector2(24, 0) + Vector2(0, 24), # Bottom right corner
		position - Vector2(24, 0) + Vector2(0, 24) ] # Bottom left corne
	DisplayServer.window_set_mouse_passthrough(texture_corners)

func clear_state() -> void:
		#$AnimatedSprite2D.animation = \"idle\"
		$AnimatedSprite2D.flip_h = false
		$AnimatedSprite2D.flip_v = false
		sticked_top = false
		sticked_side = false
		sticked_bottom = false
		flinging = false
	


func _on_timer_4_timeout() -> void:
	draggable = true

func append_array_x(read_x: int):
	x_speed_array.append(read_x)
	if x_speed_array.size() == 11:
		x_speed_array.pop_front()
func append_array_y(read_y: int):
	y_speed_array.append(read_y)
	if y_speed_array.size() == 11:
		y_speed_array.pop_front()
func calculate_x_acceleration():
	if x_speed_array.size() >= 10:
		return (x_speed_array[9] - x_speed_array[0]) / 10
func calculate_y_acceleration():
	if y_speed_array.size() >= 10:
		return (y_speed_array[9] - y_speed_array[0]) /10
func calculate_x_velocity():
	return flinging_velocity_x * 0.90
func calculate_y_velocity():
	return (falling_velocity.y * falling_gravity) + (1 *falling_gravity)


func _on_timer_5_timeout() -> void:
	dragged_long = true


func _on_timer_6_timeout() -> void:
	heart_visible = false
	$Window.hide()
	$Window/Sprite2D.modulate.a8 = 100
	heart_rotate = false
	$Windo
"

[sub_resource type="SpriteFrames" id="SpriteFrames_5v4hp"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": ExtResource("2_40ims")
}],
"loop": true,
"name": &"fall",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("2_tj1yi")
}],
"loop": true,
"name": &"falling",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("1_x3e4l")
}, {
"duration": 1.0,
"texture": ExtResource("2_tj1yi")
}, {
"duration": 1.0,
"texture": ExtResource("1_x3e4l")
}, {
"duration": 1.0,
"texture": ExtResource("3_63mtt")
}, {
"duration": 1.0,
"texture": ExtResource("1_x3e4l")
}, {
"duration": 1.0,
"texture": ExtResource("2_tj1yi")
}],
"loop": true,
"name": &"idle",
"speed": 1.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("3_63mtt")
}],
"loop": true,
"name": &"up",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": ExtResource("4_f1ch0")
}, {
"duration": 1.0,
"texture": ExtResource("5_y5b51")
}],
"loop": false,
"name": &"walk",
"speed": 10.0
}]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_ghulo"]
size = Vector2(46, 45)

[node name="Player" type="Area2D"]
visibility_layer = 3
position = Vector2(63, 40)
script = SubResource("GDScript_prqq1")
metadata/_edit_group_ = true

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
sprite_frames = SubResource("SpriteFrames_5v4hp")
animation = &"falling"
autoplay = "idle"

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, 1.5)
shape = SubResource("RectangleShape2D_ghulo")

[node name="Timer" type="Timer" parent="."]
wait_time = 5.0
autostart = true

[node name="Timer2" type="Timer" parent="."]

[node name="Timer3" type="Timer" parent="."]

[node name="Timer4" type="Timer" parent="."]

[node name="Timer5" type="Timer" parent="."]

[node name="Timer6" type="Timer" parent="."]
wait_time = 2.0

[node name="Window" type="Window" parent="."]
transparent_bg = true
size = Vector2i(48, 40)
visible = false
transient = true
transient_to_focused = true
exclusive = true
unresizable = true
borderless = true
always_on_top = true
transparent = true
unfocusable = true
popup_window = true

[node name="Sprite2D" type="Sprite2D" parent="Window"]
position = Vector2(24, 24)
texture = ExtResource("7_ucvvb")

[connection signal="timeout" from="Timer" to="." method="_on_timer_timeout"]
[connection signal="timeout" from="Timer2" to="." method="_on_timer_2_timeout"]
[connection signal="timeout" from="Timer3" to="." method="_on_timer_3_timeout"]
[connection signal="timeout" from="Timer4" to="." method="_on_timer_4_timeout"]
[connection signal="timeout" from="Timer5" to="." method="_on_timer_5_timeout"]
[connection signal="timeout" from="Timer6" to="." method="_on_timer_6_timeout"]
